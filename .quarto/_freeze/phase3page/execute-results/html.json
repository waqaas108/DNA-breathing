{
  "hash": "42179d8f22a2bf704379295cda1762cc",
  "result": {
    "markdown": "---\ntitle: Analysis of gcPBM data\nfilters:\n   - lightbox\nlightbox: auto\ntbl-cap-location: bottom\n---\n\n<style>\n  code {\n    white-space : pre-wrap !important;\n    word-break: break-word;\n  }\n</style>\n\n## Overview on the Dataset and Data Processing\n\n### Bubbles\n\nWe acquired gcPBM datasets for three TFs (MAX, MAD, MYC) from Alexandrov Boian's lab. The data was about yay high and yay wide. We also acquired corresponding feature data for flipping and bubbles.\n\nThe bubble data, when acquired, was in the form of matrices with 130 rows and 36 columns. The individual columns represented base-pair positions, and rows represented time in picoseconds. The values in the matrix represented the distance between complementary base pairs at that position and time.\n\n::: {#fig-Bubble_Graphs layout-ncol=3}\n![](figs/phase3/bubble_raw/image.png){group=\"raw_bubble\"}\n\n![](figs/phase3/bubble_raw/image1.png){group=\"raw_bubble\"}\n\n![](figs/phase3/bubble_raw/image2.png){group=\"raw_bubble\"}\n\nBubble heatmaps of sequences with the highest bubble values across all TFs (TF_partition_id - bubble_value)\n:::\n\nWe investigated multiple methods to optimally encode the bubble data to provide it to the CNN as an additional input channel alongside one-hot encoded sequence data.\n\n::: {#fig-Affinity_and_Bubble_Histograms layout=\"[60,-5,60]\"}\n![Normalized affinity values for each sequence in each TF](figs/phase3/affinity_histogram.png){group=\"histogram\"}\n\n![Logarithmic distribution of all bubble values for each TF](figs/phase3/bubble_histogram.png){group=\"histogram\"}\n\ngcPBM exploration of affinity and bubble data values\n:::\n\nWe experimented with taking the average value across all time points, filtering this mean curve, and using the maxima of the resultant curve to delineate a bubble across a certain base pair window focused on the maxima.\n\n::: {#fig-Processed_Bubble layout=\"[60,-5,60]\"}\n![](figs/phase3/processed_bubble.png){group=\"processed_bubble\"}\n\n![](figs/phase3/processed_bubble 2.png){group=\"processed_bubble\"}\n\nInitial attempt at processing bubble data (left to right: heatmap, mean curve, filtered curve, maxima of filtered curve with 3 base pair window)\n:::\n\nUsing the different variants in our gridsearch for best model parameters revealed no clear winner. We decided to investigate the bubble percentile values and eventually decided on all locations at timepoint 0 (t=0) with a value > 0.03 as bubbles.\n\n### Motifs\n\nWe tried to acquire motifs for the TFs from the JASPAR database, but we were unable to find motifs for MAD. We then used the motifs for MAX and MYC to scan for motif presence in the sequences of the gcPBM data. We used the FIMO tool from the MEME suite to scan for motif presence. We used the following parameters:\n\nTBD\n\n### Processed Data\n\nOnce we had the motifs and bubbles identified and tied to base pair locations, we did some basic exploration of the sequences and how motifs and bubbles presented themselves.\n\nTop 5 sequences per TF in terms of binding affinity that also have bubble features:\n\n\nTF = max\n\n```{code}\n1.\tseq_id = 4831\n1.\tDNA_sequence    = TGTGGCTTATCAAACCACGTGGTTTATCAAAATAAT\n1.\tBubble_sequence = ------+++++-----------++++++++++++--\n1.\tMotif_sequence  = -------------++++++++++-------------\n2.\tseq_id = 4187\n2.\tDNA_sequence    = GAATTTGACCAAAACCACGTGGTTTGGCTGCAAGTT\n2.\tBubble_sequence = -+++--------------------------------\n2.\tMotif_sequence  = -------------++++++++++-------------\n3.\tseq_id = 5934\n3.\tDNA_sequence    = ATCAGGAATCTGGACCACGTGGTCAGGCAGAACCAG\n3.\tBubble_sequence = ------+-----------------------------\n3.\tMotif_sequence  = -------------++++++++++-------------\n4.\tseq_id = 4471\n4.\tDNA_sequence    = GGGCTTATGAGAGACCACGTGGTCTTGTGCTTTAGT\n4.\tBubble_sequence = ------+-----------------------------\n4.\tMotif_sequence  = -------------++++++++++-------------\n5.\tseq_id = 8206\n5.\tDNA_sequence    = ACAACCACAGAAAACCACGTGGTTTGCTCTGAAATT\n5.\tBubble_sequence = ----------++-------------------++---\n5.\tMotif_sequence  = -------------++++++++++-------------\n```\n\n\nTF = myc\n\n```{code}\n1.\tseq_id = 5288\n1.\tDNA_sequence    = TGTGGCTTATCAAACCACGTGGTTTATCAAAATAAT\n1.\tBubble_sequence = ------++++++----------++++++++++++--\n1.\tMotif_sequence  = ------------++++++++++++------------\n2.\tseq_id = 3034\n2.\tDNA_sequence    = GAATTTGACCAAAACCACGTGGTTTGGCTGCAAGTT\n2.\tBubble_sequence = --++--------------------------------\n2.\tMotif_sequence  = ------------++++++++++++------------\n3.\tseq_id = 3153\n3.\tDNA_sequence    = CTAGAACCTTTGTACCACGTGGCATTTTTTTAAACT\n3.\tBubble_sequence = -----------------------+++++++++----\n3.\tMotif_sequence  = ------------++++++++++++------------\n4.\tseq_id = 909\n4.\tDNA_sequence    = GGGCTTATGAGAGACCACGTGGTCTTGTGCTTTAGT\n4.\tBubble_sequence = -----++-----------------------------\n4.\tMotif_sequence  = ------------++++++++++++------------\n5.\tseq_id = 3063\n5.\tDNA_sequence    = ATCAGGAATCTGGACCACGTGGTCAGGCAGAACCAG\n5.\tBubble_sequence = ------+-----------------------------\n5.\tMotif_sequence  = ------------++++++++++++------------\n```\n\n\n## Machine Learning Investigation\n\nWe used a CNN to predict the binding affinity of a TF to a DNA sequence. Our initial models were trained using only the sequences, using a gridsearch to find the best model parameters. We used the following parameters:\n\n\n```{code}\nkernel size: 3, 5, 7, 9\nnumber of filters: 16, 32, 64, 128\nnumber of layers: 1, 2, 3\npooling: 3, 1\n```\n\n\nAcross all TFs, the best model parameters were a kernel size of 7, 64 filters in the first layer, 3 layers, and no pooling (1). We then used these parameters to train models with the bubble data as an additional input channel, and we contrasted the performance of these models.\n\n::: {#fig-Model_Scatterplots layout=\"[60,-5,60,-5,60]\"}\n![](figs/phase3/scatterplots_7/mad_seq_only_1_7_64_3.png){group=\"scatterplot\"}\n\n![](figs/phase3/scatterplots_7/max_seq_only_1_7_64_3.png){group=\"scatterplot\"}\n\n![](figs/phase3/scatterplots_7/myc_seq_only_1_7_64_3.png){group=\"scatterplot\"}\n\nScatterplot showcasing the parameters and results from the best model for each TF\n:::\n\nThe unanimous conclusion was that the models trained with the bubble data performed worse than the models trained with only the sequence data. We then revised the way we were approaching the bubble data.\n\nAfter observing the distribution patterns for motifs and bubbles, we decided to redo the gridsearch by searching in the range of kernel size = 6, 8, 10, and comparing sequence only models to models including bubble features.\n\nTF: Mad\n\n\n```{code}\nBest to worst model\nModel: seq_only_1_6_64_3, MSE: 0.025164015591144562, r2: 0.9751617209427638\nModel: seq_only_1_8_64_3, MSE: 0.02559092827141285, r2: 0.9747403303054708\nModel: bubble_linear_1_6_64_3, MSE: 0.025975389406085014, r2: 0.9743608481893277\nModel: seq_only_1_10_64_3, MSE: 0.025992512702941895, r2: 0.9743439469430584\nModel: bubble_linear_1_8_64_3, MSE: 0.02697504125535488, r2: 0.9733741378803168\nModel: bubble_linear_1_10_64_3, MSE: 0.02804403379559517, r2: 0.9723189799559782\n```\n\n\n::: {#fig-Model_Scatterplots layout=\"[1,1,1],[1,1,1]\"}\n![](figs/phase3/scatterplots_6810/mad_seq_only_1_6_64_3.png){group=\"scatterplot1\"}\n\n![](figs/phase3/scatterplots_6810/mad_seq_only_1_8_64_3.png){group=\"scatterplot1\"}\n\n![](figs/phase3/scatterplots_6810/mad_seq_only_1_10_64_3.png){group=\"scatterplot1\"}\n\n![](figs/phase3/scatterplots_6810/mad_bubble_linear_1_6_64_3.png){group=\"scatterplot1\"}\n\n![](figs/phase3/scatterplots_6810/mad_bubble_linear_1_8_64_3.png){group=\"scatterplot1\"}\n\n![](figs/phase3/scatterplots_6810/mad_bubble_linear_1_10_64_3.png){group=\"scatterplot1\"}\n\nModel comparison using Scatterplots across MAD\n:::\n\nTF: Max\n\n\n```{code}\nBest to worst model\nModel: bubble_linear_1_6_64_3, MSE: 0.04008778929710388, r2: 0.960649553399618\nModel: seq_only_1_6_64_3, MSE: 0.04050329700112343, r2: 0.9602416902661023\nModel: seq_only_1_8_64_3, MSE: 0.040858376771211624, r2: 0.9598931401387409\nModel: seq_only_1_10_64_3, MSE: 0.04170531406998634, r2: 0.9590617832927455\nModel: bubble_linear_1_8_64_3, MSE: 0.0423930287361145, r2: 0.9583867144681565\nModel: bubble_linear_1_10_64_3, MSE: 0.043693408370018005, r2: 0.9571102520169519\n```\n\n\n::: {#fig-Model_Scatterplots layout=\"[1,1,1],[1,1,1]\"}\n![](figs/phase3/scatterplots_6810/max_seq_only_1_6_64_3.png){group=\"scatterplot2\"}\n\n![](figs/phase3/scatterplots_6810/max_seq_only_1_8_64_3.png){group=\"scatterplot2\"}\n\n![](figs/phase3/scatterplots_6810/max_seq_only_1_10_64_3.png){group=\"scatterplot2\"}\n\n![](figs/phase3/scatterplots_6810/max_bubble_linear_1_6_64_3.png){group=\"scatterplot2\"}\n\n![](figs/phase3/scatterplots_6810/max_bubble_linear_1_8_64_3.png){group=\"scatterplot2\"}\n\n![](figs/phase3/scatterplots_6810/max_bubble_linear_1_10_64_3.png){group=\"scatterplot2\"}\n\nModel comparison using Scatterplots across MAX\n:::\n\nTF: Myc\n\n\n```{code}\nBest to worst model\nModel: seq_only_1_8_64_3, MSE: 0.05695045739412308, r2: 0.9444290673365138\nModel: seq_only_1_10_64_3, MSE: 0.05770198628306389, r2: 0.9436957503397924\nModel: bubble_linear_1_8_64_3, MSE: 0.05852825567126274, r2: 0.9428894908346188\nModel: seq_only_1_6_64_3, MSE: 0.060217346996068954, r2: 0.9412413163392869\nModel: bubble_linear_1_6_64_3, MSE: 0.060966987162828445, r2: 0.940509840597948\nModel: bubble_linear_1_10_64_3, MSE: 0.06115123629570007, r2: 0.9403300450380424\n```\n\n\n::: {#fig-Model_Scatterplots layout=\"[1,1,1],[1,1,1]\"}\n![](figs/phase3/scatterplots_6810/myc_seq_only_1_6_64_3.png){group=\"scatterplot3\"}\n\n![](figs/phase3/scatterplots_6810/myc_seq_only_1_8_64_3.png){group=\"scatterplot3\"}\n\n![](figs/phase3/scatterplots_6810/myc_seq_only_1_10_64_3.png){group=\"scatterplot3\"}\n\n![](figs/phase3/scatterplots_6810/myc_bubble_linear_1_6_64_3.png){group=\"scatterplot3\"}\n\n![](figs/phase3/scatterplots_6810/myc_bubble_linear_1_8_64_3.png){group=\"scatterplot3\"}\n\n![](figs/phase3/scatterplots_6810/myc_bubble_linear_1_10_64_3.png){group=\"scatterplot3\"}\n\nModel comparison using Scatterplots across MYC\n:::\n\nAt a kernel size of 6, MAX seems to benefit from the inclusion of bubble data, while MAD and MYC do not seem to benefit from bubble data at all. The results were not very conclusive, so we decided to focus on a more statistical approach.\n\n## Statistical Investigation\n\nWe conducted statistical investigations into the relationship between bubbles, motifs, and binding affinity. Our first investigation was a t-test to see if the presence of a bubble significantly affected binding affinity.\n\n\n```{code}\nMAD\nTtest_indResult(statistic=8.00742826839087, pvalue=1.3472019719993843e-15)\n\nMAX\nTtest_indResult(statistic=12.270239455302075, pvalue=2.5385730406292183e-34)\n\nMYC\nTtest_indResult(statistic=5.339201658963607, pvalue=9.632386462326223e-08)\n```\n\n\n::: {#fig-box_and_histograms layout-ncol=2}\n![](figs/phase3/bubble_threshold_ttest/mad_bp.png){group=\"boxplot_histogram\"}\n\n![](figs/phase3/bubble_threshold_ttest/mad_hg.png){group=\"boxplot_histogram\"}\n\n![](figs/phase3/bubble_threshold_ttest/max_bp.png){group=\"boxplot_histogram\"}\n\n![](figs/phase3/bubble_threshold_ttest/max_hg.png){group=\"boxplot_histogram\"}\n\n![](figs/phase3/bubble_threshold_ttest/myc_bp.png){group=\"boxplot_histogram\"}\n\n![](figs/phase3/bubble_threshold_ttest/myc_hg.png){group=\"boxplot_histogram\"}\n\nBoxplots and histograms of binding affinity for sequences with and without bubbles.\n:::\n\nThere appeared to be a significant relationship between bubble presence and binding affinity.\n\nSince we were unable to find a motif for MAD from JASPAR, the statistical analyses investigating motifs were conducted with the data for MAX and MYC only.\n\n### Fischer's Exact Test\n\nWe conducted a Fischer's Exact Test to see if the presence of a bubble and motif together significantly affected binding affinity. We counted the base pair positions across our entire dataset that had a bubble, motif, or both, and used these counts to construct a contingency table for the Fischer's Exact Test.\n\n::: {#fig-Fischer}\n\n```{code}\n{'max': {'L': 308448, 'B': 12247, 'M': 20190, 'x': 140},\n 'myc': {'L': 249336, 'B': 10106, 'M': 27984, 'x': 194}}\n```\n\n```{code}\nTF: max\nContingency Table:\n         | Bubble+ | Bubble-\nMotif+   |   140   |   20050\nMotif-   |   12107   |   276151\nOdds Ratio: 0.15926624341104784\nP-value: 2.0930098404665845e-196\n\nTF: myc\nContingency Table:\n         | Bubble+ | Bubble-\nMotif+   |   194   |   27790\nMotif-   |   9912   |   211440\nOdds Ratio: 0.14891520370262265\nP-value: 4.150518659943197e-290\n```\n\n\nFisher’s Exact test using all sequences: L = total length of sequences, B = coordinates with a bubble, M = coordinates with a motif, x = coordinates with both a motif and bubble.\n:::\n\nThe results of the Fischer's Exact Test showed that the presence of a bubble and motif together significantly affected binding affinity.\n\n### The effect of the distance between bubbles and motifs\n\nWe then investigated the effect of the distance between bubbles and motifs on binding affinity. To this end, we categorized the top 25% of sequences by binding affinity to be positive sequences. We then defined close distances between motifs and bubbles using a maximum threshold, and then performed a fischer's exact test at different thresholds.\n\n::: {#fig-Fischer layout=\"[60,-5,60]\"}\n![](figs/phase3/binding_posvneg_distance/max_posvneg.png){group=\"bubble_motif_distance\"}\n\n![](figs/phase3/binding_posvneg_distance/myc_posvneg.png){group=\"bubble_motif_distance\"}\n\nHistograms showing the distribution of distances between bubbles and motifs for positive and negative sequences.\n:::\n\n| Threshold | Max Odds Ratio (P-value) | Myc Odds Ratio (P-value) |\n| --------- | ------------------------- | ------------------------- |\n| ≤ 1       | inf (0.334863)            | 1.839879 (0.000567)       |\n| ≤ 2       | inf (0.162437)            | 1.396816 (0.035636)       |\n| ≤ 3       | inf (0.063436)            | 0.991813 (1.000000)       |\n| ≤ 4       | 1.939929 (0.658042)       | 0.888585 (0.474167)       |\n| ≤ 5       | 1.413462 (0.658332)       | 0.834876 (0.306648)       |\n\n: Summary of the results of the Fischer's Exact Test at different thresholds. {#tbl-letters}\n\nThe results were significant for MYC at the 1 and 2 thresholds at the 0.05 significance level.\n\n## Linear Regressions\n\nWe then conducted linear regressions to see the degree to which the presence of a bubble, motif, and an interaction feature significantly affected binding affinity.\n\n::: {#tbl-panel layout-ncol=1}\n|                       | coef                   | std err               | t                     | P>|t|                   | [0.025 | 0.975]               |\n| --------------------- | ----------------------- | ---------------------- | --------------------- | ---------------------- | ------ | ------ |\n| const                 | -0.5620                | 0.008                  | -68.981               | 0.000                  | -0.578 | -0.546 |\n| motif_binary           | 2.0056                 | 0.017                  | 119.550               | 0.000                  | 1.973  | 2.039  |\n| bubble_binary          | 0.3153                 | 0.014                  | 22.047                | 0.000                  | 0.287  | 0.343  |\n| motif_and_bubble_binary| -0.1396                | 0.029                  | -4.737                | 0.000                  | -0.197 | -0.082 |\n\n\n: Linear regression results for MAX (R-squared = 0.708, F-statistic = 6910). {#tbl-panel1}\n\n|                       | coef                   | std err               | t                     | P>|t|                   | [0.025 | 0.975]               |\n| --------------------- | ----------------------- | ---------------------- | --------------------- | ---------------------- | ------ | ------ |\n| const                 | -0.5018                | 0.014                  | -35.384               | 0.000                  | -0.530 | -0.474 |\n| motif_binary           | 1.3369                 | 0.024                  | 55.488                | 0.000                  | 1.290  | 1.384  |\n| bubble_binary          | 0.1645                 | 0.024                  | 6.899                 | 0.000                  | 0.118  | 0.211  |\n| motif_and_bubble_binary| 0.0270                | 0.042                  | 0.648                 | 0.517                  | -0.055 | 0.109  |\n\n\n: Linear regression results for MYC (R-squared = 0.406, F-statistic = 1579). {#tbl-panel2}\n\nLinear Regression of all sequences with Motif, Bubble, and Interaction Features.\n:::\n\n\n\n::: {#tbl-panel layout-ncol=1}\n|              | coef    | std err | t       | P>|t|     [0.025 | 0.975] |\n| ------------ | ------- | ------- | ------- | ------- | ------- | ------- |\n| const        | -0.0890 | 0.013   | -6.817  | 0.000   | -0.115  | -0.063  |\n| bubble_binary | 0.2812 | 0.023   | 12.270 | 0.000   | 0.236   | 0.326   |\n\n: Linear regression results for MAX (R-squared = 0.017, F-statistic = 150.6). {#tbl-panel1}\n\n|               | coef    | std err | t       | P>|t|     [0.025 | 0.975] |\n| ------------- | ------- | ------- | ------- | ------- | ------- | ------- |\n| const         | -0.0386 | 0.015   | -2.601  | 0.009   | -0.068  | -0.010  |\n| bubble_binary | 0.1351  | 0.025   | 5.339   | 0.000   | 0.086   | 0.185   |\n\n: Linear regression results for MYC (R-squared = 0.004, F-statistic = 28.51). {#tbl-panel2}\n\nLinear Regression of all sequences with Bubble Feature only.\n:::\n\nThe results of the linear regressions showed that the presence of a bubble and motif significantly affected binding affinity, and that the interaction feature did not significantly affect binding affinity. The regressions performed with bubble data showed the extent to which bubbles alone explain binding.\n\n## Correlations of Motif positions and Flipping features\n\nAnother hypothesis of ours was that flipping features inside or near motifs may determine binding affinity. To test this, we extracted all DNA sequences with motifs. Then we computed the average flipping feature across all positions in the motifs, and found the correlation between this average flipping feature and the binding affinity of the sequence for every sequence.\n\n\n```{code}\nTF = max\nPearson Correlation with Motif Flip Feature: Correlation = 0.21, p-value = 6.98e-21\nPearson Correlation with Motif Coord Feature: Correlation = 0.19, p-value = 1.32e-18\nPearson Correlation with Motif Coord^2 Feature: Correlation = 0.18, p-value = 1.02e-16\n```\n\n```{code}\nTF = myc\nPearson Correlation with Motif Flip Feature: Correlation = 0.10, p-value = 5.81e-07\nPearson Correlation with Motif Coord Feature: Correlation = 0.17, p-value = 4.37e-17\nPearson Correlation with Motif Coord^2 Feature: Correlation = 0.12, p-value = 6.81e-09\n```\n\n\n::: {#fig-Correlation layout-ncol=1}\n![TF = max](figs/phase3/flip_correlation/max.png){group=\"correlation\"}\n\n![TF = myc](figs/phase3/flip_correlation/myc.png){group=\"correlation\"}\n\nScatterplots showing the average flipping feature of motifs against binding affinity.\n:::\n\nWe then calculated correlations for each individual base pair position in the motif.\n\n::: {#fig-Correlation_bar layout-ncol=3}\n![](figs/phase3/flip_correlation/flip_max.png){group=\"correlation_bar\"}\n\n![](figs/phase3/flip_correlation/coord_max.png.png){group=\"correlation_bar\"}\n\n![](figs/phase3/flip_correlation/coordsq_max.png){group=\"correlation_bar\"}\n\n![](figs/phase3/flip_correlation/flip_myc.png){group=\"correlation_bar\"}\n\n![](figs/phase3/flip_correlation/coord_myc.png){group=\"correlation_bar\"}\n\n![](figs/phase3/flip_correlation/coordsq_myc.png){group=\"correlation_bar\"}\n\nBarplots showing the correlation (and associated p-value) between flipping features and binding affinity for each base pair position in the motif.\n:::\n\n",
    "supporting": [
      "phase3page_files"
    ],
    "filters": [],
    "includes": {}
  }
}